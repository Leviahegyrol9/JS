<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Felhasználói profil és feladatkezelő</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

  <div class="mb-3 text-end">
    <button id="logoutBtn" class="btn btn-danger d-none">Kijelentkezés</button>
  </div>

  <!-- Bejelentkezés -->
  <div id="loginDiv">
    <h2>Bejelentkezés</h2>
    <input type="text" id="usernameInput" placeholder="Felhasználónév" class="form-control mb-2">
    <button id="loginBtn" class="btn btn-primary">Belépés</button>
  </div>

  <!-- Profil -->
  <div id="profileDiv" class="d-none">
    <h2>Profil</h2>
    <input type="text" id="fullName" placeholder="Teljes név" class="form-control mb-2">
    <input type="email" id="email" placeholder="E-mail" class="form-control mb-2">
    <input type="text" id="favColor" placeholder="Kedvenc szín" class="form-control mb-2">
    <button id="saveProfileBtn" class="btn btn-success mb-2">Mentés</button>
    <button id="toTasksBtn" class="btn btn-secondary">Tovább a feladatokhoz</button>
  </div>

  <!-- Feladatkezelő -->
  <div id="taskDiv" class="d-none">
    <h2>Feladatkezelő</h2>
    <input type="text" id="taskTitle" placeholder="Cím" class="form-control mb-2">
    <input type="text" id="taskDesc" placeholder="Leírás" class="form-control mb-2">
    <input type="date" id="taskDue" class="form-control mb-2">
    <button id="addTaskBtn" class="btn btn-primary mb-4">Hozzáadás</button>
    <div id="taskList" class="row gy-2"></div>
  </div>

  <script>
    const loginDiv = document.getElementById('loginDiv');
    const profileDiv = document.getElementById('profileDiv');
    const taskDiv = document.getElementById('taskDiv');
    const logoutBtn = document.getElementById('logoutBtn');

    function show(div) {
      loginDiv.classList.add('d-none');
      profileDiv.classList.add('d-none');
      taskDiv.classList.add('d-none');
      div.classList.remove('d-none');
      logoutBtn.classList.remove('d-none');
    }

    document.getElementById('loginBtn').onclick = () => {
      const username = document.getElementById('usernameInput').value.trim();
      if (username) {
        sessionStorage.setItem('username', username);
        loadProfile();
        show(profileDiv);
      }
    };

    document.getElementById('saveProfileBtn').onclick = () => {
      document.cookie = `fullname=${document.getElementById('fullName').value}; max-age=86400`;
      document.cookie = `email=${document.getElementById('email').value}; max-age=86400`;
      document.cookie = `favColor=${document.getElementById('favColor').value}; max-age=86400`;
      alert('Profil mentve!');
    };

    document.getElementById('toTasksBtn').onclick = () => {
      show(taskDiv);
      renderTasks();
    };

    document.getElementById('addTaskBtn').onclick = () => {
      const username = sessionStorage.getItem('username');
      const title = document.getElementById('taskTitle').value;
      const desc = document.getElementById('taskDesc').value;
      const due = document.getElementById('taskDue').value;

      if (title && due) {
        const task = { title, desc, due, done: false };
        const tasks = JSON.parse(localStorage.getItem(username) || '[]');
        tasks.push(task);
        localStorage.setItem(username, JSON.stringify(tasks));
        renderTasks();
      }
    };

    function renderTasks() {
      const username = sessionStorage.getItem('username');
      const tasks = JSON.parse(localStorage.getItem(username) || '[]');
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';

      tasks.forEach((task, index) => {
        const card = document.createElement('div');
        card.className = 'col-md-4';
        card.innerHTML = `
          <div class="card ${task.done ? 'border-success' : ''}">
            <div class="card-body">
              <h5 class="card-title">${task.title}</h5>
              <p class="card-text">${task.desc}</p>
              <p class="card-text"><small>Határidő: ${task.due}</small></p>
              <button class="btn btn-sm btn-success me-2" onclick="markDone(${index})">Kész</button>
              <button class="btn btn-sm btn-danger" onclick="deleteTask(${index})">Törlés</button>
            </div>
          </div>
        `;
        taskList.appendChild(card);
      });
    }

    function markDone(index) {
      const username = sessionStorage.getItem('username');
      const tasks = JSON.parse(localStorage.getItem(username));
      tasks[index].done = true;
      localStorage.setItem(username, JSON.stringify(tasks));
      renderTasks();
    }

    function deleteTask(index) {
      const username = sessionStorage.getItem('username');
      const tasks = JSON.parse(localStorage.getItem(username));
      tasks.splice(index, 1);
      localStorage.setItem(username, JSON.stringify(tasks));
      renderTasks();
    }

    logoutBtn.onclick = () => {
      sessionStorage.clear();
      logoutBtn.classList.add('d-none');
      show(loginDiv);
    };

    function loadProfile() {
      const cookies = Object.fromEntries(document.cookie.split('; ').map(c => c.split('=')));
      document.getElementById('fullName').value = cookies.fullname || '';
      document.getElementById('email').value = cookies.email || '';
      document.getElementById('favColor').value = cookies.favColor || '';
    }

    if (sessionStorage.getItem('username')) {
      loadProfile();
      show(profileDiv);
    }
  </script>
</body>
</html>
